{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nvar _jsxFileName = \"/Users/xxxmrg/Downloads/Code/Git/gabriel-chat/pages/index.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { AppBar, Toolbar, Typography, CssBaseline, Container, Paper, Grid, TextField, IconButton, Fab, useScrollTrigger, Slide, Badge } from '@material-ui/core';\nimport Chat from '../components/chat';\nimport TelegramIcon from '@material-ui/icons/Telegram';\nimport MoreIcon from '@material-ui/icons/MoreVert';\nimport PeopleOutlinedIcon from '@material-ui/icons/PeopleOutlined';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useRef, useState, useEffect } from 'react';\nimport io from 'socket.io-client';\nvar socket = io('https://api.xkeith.tech:3000');\nvar useStyles = makeStyles({\n  send: {\n    background: 'linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)',\n    border: 0,\n    borderRadius: 3,\n    boxShadow: '0 3px 5px 2px rgba(255, 105, 135, .3)',\n    color: 'white',\n    height: 48,\n    padding: '0 30px'\n  },\n  root: {\n    maxHeight: '100vh',\n    overflow: 'hidden',\n    padding: 0\n  },\n  chat: {\n    backgroundColor: '#e0f7fa',\n    height: '100vh',\n    overflow: 'auto'\n  },\n  input: {\n    width: '75%'\n  },\n  appBar: {\n    top: 'auto',\n    bottom: 0,\n    background: 'linear-gradient(45deg, #e0f7fa 30%, #0097a7 90%)'\n  },\n  grow: {\n    flexGrow: 1\n  },\n  fabButton: {\n    position: 'absolute',\n    zIndex: 1,\n    top: -30,\n    left: 0,\n    right: 0,\n    margin: '0 auto'\n  }\n}); // hoc to control app bar hidden\n\nfunction HideOnScroll(props) {\n  var target = props.target,\n      children = props.children;\n  var trigger = useScrollTrigger({\n    target: target || undefined\n  });\n\n  if (target) {\n    return __jsx(Slide, {\n      appear: false,\n      direction: \"down\",\n      \"in\": !trigger,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72\n      },\n      __self: this\n    }, children);\n  }\n\n  return __jsx(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77\n    },\n    __self: this\n  }, children);\n}\n\nvar fetchData = function fetchData(url) {\n  return fetch(url).then(function (res) {\n    return res.json();\n  });\n};\n\nexport default function Layout(props) {\n  var classes = useStyles();\n  var chat = useRef(null);\n\n  var _useState = useState([]),\n      data = _useState[0],\n      setData = _useState[1];\n\n  var _useState2 = useState(''),\n      message = _useState2[0],\n      setMessage = _useState2[1];\n\n  var _useState3 = useState(null),\n      trigger = _useState3[0],\n      setTrigger = _useState3[1];\n\n  var _useState4 = useState(''),\n      userName = _useState4[0],\n      setName = _useState4[1];\n\n  var _useState5 = useState(0),\n      online = _useState5[0],\n      setOnline = _useState5[1];\n\n  var handleMessage = function handleMessage(e) {\n    e.preventDefault();\n    setMessage(e.target.value);\n  };\n\n  var handleSend = function handleSend() {\n    if (message !== '') {\n      var messageObject = {\n        name: userName,\n        message: message\n      };\n      socket.emit('chat message', _JSON$stringify(messageObject));\n      setMessage('');\n    }\n  };\n\n  var handleKeyDown = function handleKeyDown(e) {\n    if (e.which === 13) {\n      handleSend();\n    }\n  };\n\n  useEffect(function () {\n    socket.on('chat message', function (msg) {\n      var _JSON$parse = JSON.parse(msg),\n          name = _JSON$parse.name,\n          message = _JSON$parse.message;\n\n      var current = chat.current;\n      setData([].concat(_toConsumableArray(data), [{\n        name: name,\n        message: message,\n        avatar: \"https://api.adorable.io/avatars/285/\".concat(name, \".png\")\n      }])); // make scrollbar to the bottom\n\n      current.scrollTop = current.scrollHeight;\n    });\n    socket.on('user change', function (msg) {\n      console.log(msg);\n    }); // must remove the socket when unmounted\n\n    return function () {\n      socket.off('chat message');\n      socket.off('user change');\n    };\n  });\n  useEffect(function () {\n    setTrigger(chat.current);\n  }, []);\n  useEffect(function () {\n    fetchData('/api/getName').then(function (res) {\n      setName(res.name);\n    });\n  }, []);\n  return __jsx(React.Fragment, null, __jsx(CssBaseline, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149\n    },\n    __self: this\n  }), __jsx(Container, {\n    className: classes.root,\n    maxWidth: \"lg\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150\n    },\n    __self: this\n  }, __jsx(Paper, {\n    elevation: 3,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151\n    },\n    __self: this\n  }, __jsx(Grid, {\n    container: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152\n    },\n    __self: this\n  }, __jsx(Grid, {\n    item: true,\n    xs: 12,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: classes.chat,\n    ref: chat,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154\n    },\n    __self: this\n  }, __jsx(HideOnScroll, _extends({\n    target: trigger\n  }, props, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }), __jsx(AppBar, {\n    position: \"sticky\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, __jsx(Toolbar, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, __jsx(Typography, {\n    variant: \"h6\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }, \"Gabriel Chat\"), __jsx(\"div\", {\n    className: classes.grow,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }), __jsx(Badge, {\n    badgeContent: online,\n    color: \"secondary\",\n    edge: \"end\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }, __jsx(PeopleOutlinedIcon, {\n    fontSize: \"large\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }))))), __jsx(Chat, {\n    data: data,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }))), __jsx(AppBar, {\n    position: \"sticky\",\n    className: classes.appBar,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169\n    },\n    __self: this\n  }, __jsx(Toolbar, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  }, __jsx(TextField, {\n    className: classes.input,\n    label: \"Say something...\",\n    color: \"secondary\",\n    value: message,\n    onChange: handleMessage,\n    onKeyDown: handleKeyDown,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171\n    },\n    __self: this\n  }), __jsx(Fab, {\n    color: \"secondary\",\n    \"aria-label\": \"add\",\n    className: classes.fabButton,\n    onClick: handleSend,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179\n    },\n    __self: this\n  }, __jsx(TelegramIcon, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185\n    },\n    __self: this\n  })), __jsx(\"div\", {\n    className: classes.grow,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187\n    },\n    __self: this\n  }), __jsx(IconButton, {\n    edge: \"end\",\n    color: \"inherit\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188\n    },\n    __self: this\n  }, __jsx(MoreIcon, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189\n    },\n    __self: this\n  }))))))));\n}","map":{"version":3,"sources":["/Users/xxxmrg/Downloads/Code/Git/gabriel-chat/pages/index.js"],"names":["AppBar","Toolbar","Typography","CssBaseline","Container","Paper","Grid","TextField","IconButton","Fab","useScrollTrigger","Slide","Badge","Chat","TelegramIcon","MoreIcon","PeopleOutlinedIcon","makeStyles","useRef","useState","useEffect","io","socket","useStyles","send","background","border","borderRadius","boxShadow","color","height","padding","root","maxHeight","overflow","chat","backgroundColor","input","width","appBar","top","bottom","grow","flexGrow","fabButton","position","zIndex","left","right","margin","HideOnScroll","props","target","children","trigger","undefined","fetchData","url","fetch","then","res","json","Layout","classes","data","setData","message","setMessage","setTrigger","userName","setName","online","setOnline","handleMessage","e","preventDefault","value","handleSend","messageObject","name","emit","handleKeyDown","which","on","msg","JSON","parse","current","avatar","scrollTop","scrollHeight","console","log","off"],"mappings":"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","sourcesContent":["import {\n  AppBar,\n  Toolbar,\n  Typography,\n  CssBaseline,\n  Container,\n  Paper,\n  Grid,\n  TextField,\n  IconButton,\n  Fab,\n  useScrollTrigger,\n  Slide,\n  Badge,\n} from '@material-ui/core'\nimport Chat from '../components/chat'\nimport TelegramIcon from '@material-ui/icons/Telegram'\nimport MoreIcon from '@material-ui/icons/MoreVert'\nimport PeopleOutlinedIcon from '@material-ui/icons/PeopleOutlined'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { useRef, useState, useEffect } from 'react'\nimport io from 'socket.io-client'\n\nconst socket = io('https://api.xkeith.tech:3000')\n\nconst useStyles = makeStyles({\n  send: {\n    background: 'linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)',\n    border: 0,\n    borderRadius: 3,\n    boxShadow: '0 3px 5px 2px rgba(255, 105, 135, .3)',\n    color: 'white',\n    height: 48,\n    padding: '0 30px',\n  },\n  root: {\n    maxHeight: '100vh',\n    overflow: 'hidden',\n    padding: 0,\n  },\n  chat: {\n    backgroundColor: '#e0f7fa',\n    height: '100vh',\n    overflow: 'auto',\n  },\n  input: {\n    width: '75%',\n  },\n  appBar: {\n    top: 'auto',\n    bottom: 0,\n    background: 'linear-gradient(45deg, #e0f7fa 30%, #0097a7 90%)',\n  },\n  grow: {\n    flexGrow: 1,\n  },\n  fabButton: {\n    position: 'absolute',\n    zIndex: 1,\n    top: -30,\n    left: 0,\n    right: 0,\n    margin: '0 auto',\n  },\n})\n// hoc to control app bar hidden\nfunction HideOnScroll(props) {\n  const { target, children } = props\n  const trigger = useScrollTrigger({ target: target || undefined })\n  if (target) {\n    return (\n      <Slide appear={false} direction=\"down\" in={!trigger}>\n        {children}\n      </Slide>\n    )\n  }\n  return <div>{children}</div>\n}\n\nconst fetchData = url => {\n  return fetch(url).then(res => res.json())\n}\nexport default function Layout(props) {\n  const classes = useStyles()\n  const chat = useRef(null)\n  const [data, setData] = useState([])\n  const [message, setMessage] = useState('')\n  const [trigger, setTrigger] = useState(null)\n  const [userName, setName] = useState('')\n  const [online, setOnline] = useState(0)\n\n  const handleMessage = e => {\n    e.preventDefault()\n    setMessage(e.target.value)\n  }\n  const handleSend = () => {\n    if (message !== '') {\n      const messageObject = {\n        name: userName,\n        message,\n      }\n      socket.emit('chat message', JSON.stringify(messageObject))\n      setMessage('')\n    }\n  }\n  const handleKeyDown = e => {\n    if (e.which === 13) {\n      handleSend()\n    }\n  }\n\n  useEffect(() => {\n    socket.on('chat message', msg => {\n      const { name, message } = JSON.parse(msg)\n      const { current } = chat\n      setData([\n        ...data,\n        {\n          name,\n          message,\n          avatar: `https://api.adorable.io/avatars/285/${name}.png`,\n        },\n      ])\n      // make scrollbar to the bottom\n      current.scrollTop = current.scrollHeight\n    })\n    socket.on('user change', msg => {\n      console.log(msg)\n    })\n    // must remove the socket when unmounted\n    return () => {\n      socket.off('chat message')\n      socket.off('user change')\n    }\n  })\n\n  useEffect(() => {\n    setTrigger(chat.current)\n  }, [])\n\n  useEffect(() => {\n    fetchData('/api/getName').then(res => {\n      setName(res.name)\n    })\n  }, [])\n\n  return (\n    <>\n      <CssBaseline />\n      <Container className={classes.root} maxWidth=\"lg\">\n        <Paper elevation={3}>\n          <Grid container>\n            <Grid item xs={12}>\n              <div className={classes.chat} ref={chat}>\n                <HideOnScroll target={trigger} {...props}>\n                  <AppBar position=\"sticky\">\n                    <Toolbar>\n                      <Typography variant=\"h6\">Gabriel Chat</Typography>\n                      <div className={classes.grow} />\n                      <Badge badgeContent={online} color=\"secondary\" edge=\"end\">\n                        <PeopleOutlinedIcon fontSize=\"large\" />\n                      </Badge>\n                    </Toolbar>\n                  </AppBar>\n                </HideOnScroll>\n                <Chat data={data} />\n              </div>\n            </Grid>\n            <AppBar position=\"sticky\" className={classes.appBar}>\n              <Toolbar>\n                <TextField\n                  className={classes.input}\n                  label=\"Say something...\"\n                  color=\"secondary\"\n                  value={message}\n                  onChange={handleMessage}\n                  onKeyDown={handleKeyDown}\n                />\n                <Fab\n                  color=\"secondary\"\n                  aria-label=\"add\"\n                  className={classes.fabButton}\n                  onClick={handleSend}\n                >\n                  <TelegramIcon />\n                </Fab>\n                <div className={classes.grow} />\n                <IconButton edge=\"end\" color=\"inherit\">\n                  <MoreIcon />\n                </IconButton>\n              </Toolbar>\n            </AppBar>\n          </Grid>\n        </Paper>\n      </Container>\n    </>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}